<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jesse Mu">
<title>Chapter 4: Monte Carlo approximation – Hoff Bayesian Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-68c8bffd90dad8f2b55c52d7b6410dc0.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-68c8bffd90dad8f2b55c52d7b6410dc0.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-68c8bffd90dad8f2b55c52d7b6410dc0.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-26500bfc55c7891837a911d6d50a6255.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-0358071c7a347cfe579aff309456bf3c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-26500bfc55c7891837a911d6d50a6255.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false,
  "enableExperimentalNewNoteButton": true
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Hoff Bayesian Statistics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapters" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Chapters</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-chapters">
<li>
    <a class="dropdown-item" href="./1.html">
 <span class="dropdown-text">Chapter 1: Introduction and examples</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./2.html">
 <span class="dropdown-text">Chapter 2: Belief, probability, and exchangeability</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3.html">
 <span class="dropdown-text">Chapter 3: One-parameter models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./4.html">
 <span class="dropdown-text">Chapter 4: Monte Carlo approximation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./5.html">
 <span class="dropdown-text">Chapter 5: The Normal Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./6.html">
 <span class="dropdown-text">Chapter 6: Posterior approximation with the Gibbs sampler</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./7.html">
 <span class="dropdown-text">Chapter 7: The multivariate normal model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./8.html">
 <span class="dropdown-text">Chapter 8: Group comparisons and hierarchical modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./9.html">
 <span class="dropdown-text">Chapter 9: Linear regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10.html">
 <span class="dropdown-text">Chapter 10: Nonconjugate priors and Metropolis-Hastings algorithms</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="./irm.html"> 
<span class="menu-text">Infinite Relational Model</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#the-monte-carlo-method" id="toc-the-monte-carlo-method" class="nav-link active" data-scroll-target="#the-monte-carlo-method"><span class="header-section-number">1</span> The Monte Carlo method</a>
  <ul class="collapse">
<li><a href="#numerical-evaluation" id="toc-numerical-evaluation" class="nav-link" data-scroll-target="#numerical-evaluation"><span class="header-section-number">1.1</span> Numerical evaluation</a></li>
  <li><a href="#convergence" id="toc-convergence" class="nav-link" data-scroll-target="#convergence"><span class="header-section-number">1.2</span> Convergence</a></li>
  </ul>
</li>
  <li>
<a href="#posterior-inference-for-arbitrary-functions" id="toc-posterior-inference-for-arbitrary-functions" class="nav-link" data-scroll-target="#posterior-inference-for-arbitrary-functions"><span class="header-section-number">2</span> Posterior inference for arbitrary functions</a>
  <ul class="collapse">
<li><a href="#example-log-odds" id="toc-example-log-odds" class="nav-link" data-scroll-target="#example-log-odds"><span class="header-section-number">2.1</span> Example: Log-odds</a></li>
  <li><a href="#example-2-functions-of-two-parameters" id="toc-example-2-functions-of-two-parameters" class="nav-link" data-scroll-target="#example-2-functions-of-two-parameters"><span class="header-section-number">2.2</span> Example 2: Functions of two parameters</a></li>
  </ul>
</li>
  <li><a href="#sampling-from-predictive-distributions" id="toc-sampling-from-predictive-distributions" class="nav-link" data-scroll-target="#sampling-from-predictive-distributions"><span class="header-section-number">3</span> Sampling from predictive distributions</a></li>
  <li><a href="#posterior-predictive-model-checking" id="toc-posterior-predictive-model-checking" class="nav-link" data-scroll-target="#posterior-predictive-model-checking"><span class="header-section-number">4</span> Posterior predictive model checking</a></li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5</span> Exercises</a>
  <ul class="collapse">
<li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">5.1</span> 4.1</a></li>
  <li>
<a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">5.2</span> 4.2</a>
  <ul class="collapse">
<li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a"><span class="header-section-number">5.2.1</span> a</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b"><span class="header-section-number">5.2.2</span> b</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c"><span class="header-section-number">5.2.3</span> c</a></li>
  </ul>
</li>
  <li>
<a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">5.3</span> 4.3</a>
  <ul class="collapse">
<li><a href="#a-1" id="toc-a-1" class="nav-link" data-scroll-target="#a-1"><span class="header-section-number">5.3.1</span> a</a></li>
  <li><a href="#b-1" id="toc-b-1" class="nav-link" data-scroll-target="#b-1"><span class="header-section-number">5.3.2</span> b</a></li>
  </ul>
</li>
  <li>
<a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">5.4</span> 4.6</a>
  <ul class="collapse">
<li><a href="#via-monte-carlo-sampling" id="toc-via-monte-carlo-sampling" class="nav-link" data-scroll-target="#via-monte-carlo-sampling"><span class="header-section-number">5.4.1</span> via Monte-Carlo sampling</a></li>
  <li><a href="#analytically" id="toc-analytically" class="nav-link" data-scroll-target="#analytically"><span class="header-section-number">5.4.2</span> analytically</a></li>
  </ul>
</li>
  <li>
<a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">5.5</span> 4.7</a>
  <ul class="collapse">
<li><a href="#a-2" id="toc-a-2" class="nav-link" data-scroll-target="#a-2"><span class="header-section-number">5.5.1</span> a</a></li>
  <li><a href="#b-2" id="toc-b-2" class="nav-link" data-scroll-target="#b-2"><span class="header-section-number">5.5.2</span> b</a></li>
  <li><a href="#c-1" id="toc-c-1" class="nav-link" data-scroll-target="#c-1"><span class="header-section-number">5.5.3</span> c</a></li>
  <li><a href="#d" id="toc-d" class="nav-link" data-scroll-target="#d"><span class="header-section-number">5.5.4</span> d</a></li>
  </ul>
</li>
  <li>
<a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">5.6</span> 4.8</a>
  <ul class="collapse">
<li><a href="#a-3" id="toc-a-3" class="nav-link" data-scroll-target="#a-3"><span class="header-section-number">5.6.1</span> a</a></li>
  <li><a href="#b-3" id="toc-b-3" class="nav-link" data-scroll-target="#b-3"><span class="header-section-number">5.6.2</span> b</a></li>
  <li><a href="#c-2" id="toc-c-2" class="nav-link" data-scroll-target="#c-2"><span class="header-section-number">5.6.3</span> c</a></li>
  <li><a href="#d-1" id="toc-d-1" class="nav-link" data-scroll-target="#d-1"><span class="header-section-number">5.6.4</span> d</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/edit/main/4.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/blob/main/4.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 4: Monte Carlo approximation</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jesse Mu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified: 2016-09-28: 0:00:00 (UTC)</p>
    </div>
  </div>
  
    
  </div>
  


</header><!-- Setup --><!-- Begin writing --><p>Why Monte Carlo? Often we want to calculate either arbitrary properties of posterior distributions or complex posterior distributions themselves. Often, clean analytical solutions for posterior distributions are difficult to obtain. By using computational methods, we can approximate arbitrarily complex posterior probability calculations by repeatedly sampling posteriors. Such techniques are known as Monte Carlo methods.</p>
<section id="the-monte-carlo-method" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> The Monte Carlo method</h1>
<p>We continue the last chapter, where we found posterior distributions for women without (<span class="math inline">\(\theta_1\)</span>) and with bachelor’s degrees (<span class="math inline">\(\theta_2\)</span>). Recall</p>
<p><span class="math display">\[\begin{align}
\left(\theta_1 \;\middle|\; \sum_i Y_{i, 1} = 217\right) &amp;\sim \text{Gamma}(219, 112) \\
\left(\theta_2 \;\middle|\; \sum_i Y_{i, 2} = 217\right) &amp;\sim \text{Gamma}(68, 45)
\end{align}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>To calculate the probability under these models that the mean number of children of women without bachelor’s degrees are higher than the mean number of those with bachelor’s degrees <span class="math inline">\(P(\theta_1 &gt; \theta_2 \mid \dots)\)</span>, we can do so analytically. Notice that since <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are independent, <span class="math inline">\(p(\theta_1, \theta_2) = p(\theta_1) p(\theta_2)\)</span>. If we plot <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> on the cartesian coordinate plane, the line <span class="math inline">\(\theta_1 = \theta_2\)</span> divides two regions of the plane - one where <span class="math inline">\(\theta_1 &gt; \theta_2\)</span>, the other where <span class="math inline">\(\theta_2 &gt; \theta_1\)</span>. We double-integrate the joint density <span class="math inline">\(p(\theta_1, \theta_2)\)</span> over the region we’re interested in.</p>
<p>Since for this example, the supports of <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are <span class="math inline">\([0,
\infty]\)</span>, we integrate over a portion of that region up to the line <span class="math inline">\(\theta_1 = \theta_2\)</span>:</p>
<p><span class="math display">\[\begin{align}
P(\theta_1 &gt; \theta_2 \mid y) &amp;= \int_0^\infty \left( \int_0^{\theta_1}
p(\theta_1 \mid y) p(\theta_2 \mid y) \; d\theta_2 \right) \; d\theta_1 \\
&amp;= \int_0^\infty \left( \int_0^{\theta_1}
\text{dgamma}(\theta_1, 219, 112) \times \text{dgamma}(\theta_2, 68, 45) \; d\theta_2 \right) \; d\theta_1 \\
\end{align}\]</span></p>
<p>Since Gamma distributions have well-defined PDFs, in this case the integral is computable and is reasonably easy in R:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">inner.int</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Theta.1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">Theta.1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta.1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">theta.2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="va">theta.1</span>, <span class="fl">219</span>, <span class="fl">112</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="va">theta.2</span>, <span class="fl">68</span>, <span class="fl">45</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">theta.1</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/integrate.html">integrate</a></span><span class="op">(</span><span class="va">inner.int</span>, <span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0.9725601 with absolute error &lt; 7.9e-05</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>However, when inference gets complicated, integrals may not be tractable. Alternatively, we can estimate via <em>Monte Carlo estimation</em>.</p>
<p>Notice that we can implement computational tools that allow us to sample arbitrarily from the Gamma distributions of <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>. The details of implementing these samplers, i.e.&nbsp;functions that can draw some <span class="math inline">\(\theta_i \sim p(\theta \mid y)\)</span>, are non-trivial - for an example of algorithmically sampling from a Normal distribution given just pseudo-random number generators, see the <a href="http://www.math.nyu.edu/faculty/goodman/teaching/MonteCarlo2005/notes/GaussianSampling.pdf">Box-Muller transform</a>. However, we will assume that we have these functions implemented. For example, in R we can represent <span class="math inline">\(n\)</span> random draws from a gamma distribution with parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> with the function call <code>rgamma(n, a, b)</code>.</p>
<p>The law of large numbers states that, for <span class="math inline">\(S\)</span> i.i.d. draws <span class="math inline">\(\theta^1, \dots,
\theta^S\)</span> from a distribution <span class="math inline">\(p(\theta)\)</span>, as <span class="math inline">\(S \rightarrow \infty\)</span>, <span class="math inline">\(\frac{1}{S} \sum \theta^i \rightarrow \mathbb{E}(p(\theta))\)</span>. This also implies that the variance of the sample approaches the variance of the distribution (to calcualte this, expand the formula for the variance of <span class="math inline">\(\theta\)</span> into a combination of expectations, then use the law of large numbers of the expectations).</p>
<p>Indeed, by a more advanced theorem known as the Glivenko-Cantelli Lemma, the empirical distribution function of <span class="math inline">\(\theta^1, \dots, \theta^S\)</span> approaches <span class="math inline">\(p(\theta)\)</span>. So more generally, we can approximate any quantity of interest of <span class="math inline">\(p(\theta)\)</span> to arbitrary precision using a large enough sample from that function. This is visible in the image below, which demonstrates how the histogram and kernel density estimates of larger and large samples from the <span class="math inline">\(\theta_2 \sim \text{Gamma}(68, 45)\)</span> distribution approach the distribution itself. In each panel, the true distribution is the dotted blue line.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="fl">68</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fl">45</span></span>
<span></span>
<span><span class="va">std.gamma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mc10</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'10 samples'</span><span class="op">)</span></span>
<span><span class="va">mc100</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'100 samples'</span><span class="op">)</span></span>
<span><span class="va">mc1000</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'1000 samples'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mcs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">mc10</span>, <span class="va">mc100</span>, <span class="va">mc1000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mcs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">10</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">std.gamma</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">'density'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">type</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="4_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="numerical-evaluation" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="numerical-evaluation">
<span class="header-section-number">1.1</span> Numerical evaluation</h2>
<p>The actual posterior mean of <span class="math inline">\(\theta_2 \mid y\)</span> is <span class="math inline">\(68/45 = 1.51\)</span>. Notice we can approximate this mean with the mean of the above</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'10 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc10</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>          <span class="st">'100 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc100</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>          <span class="st">'1000 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">means</span>, col.names <span class="op">=</span> <span class="st">'Estimate of E(theta)'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate of E(theta)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10 samples</td>
<td style="text-align: right;">1.419395</td>
</tr>
<tr class="even">
<td style="text-align: left;">100 samples</td>
<td style="text-align: right;">1.478601</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000 samples</td>
<td style="text-align: right;">1.496018</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can calculate probabilities of events concerning theta by counting the number of times in our sample the randomly sampled value satisfies the event. For example, to calculate <span class="math inline">\(P(\theta &lt; 1.75 \mid y)\)</span>, we observe the number of times a sampled <span class="math inline">\(\theta^{i} &lt; 1.75\)</span>. In R, comparison operators like <code>&gt;</code> or <code>==</code> operate element-wise, so <code>mc1000$theta &lt; 1.75</code> returns a boolean vector of <code>T</code>s and <code>F</code>s depending on whether the specific <span class="math inline">\(\theta^i\)</span> is indeed less than 1.75:</p>
<p>Thus, we can calculate</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">means</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'10 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc10</span><span class="op">$</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">1.75</span><span class="op">)</span>,</span>
<span>          <span class="st">'100 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc100</span><span class="op">$</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">1.75</span><span class="op">)</span>,</span>
<span>          <span class="st">'1000 samples'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">means</span>, col.names <span class="op">=</span> <span class="st">'Estimate of P(theta &lt; 1.75)'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate of P(theta &lt; 1.75)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10 samples</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">100 samples</td>
<td style="text-align: right;">0.920</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000 samples</td>
<td style="text-align: right;">0.914</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice the true probability can be calculated with via <code>pgamma(1.75, 68, 45)</code> and is 0.9.</p>
</section><section id="convergence" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="convergence">
<span class="header-section-number">1.2</span> Convergence</h2>
<p>We can measure how quickly our estimates converge to the true mean (for this example, when the true mean is known) by plotting the estimate thus far as the number of samples in our estimation increase, as below:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cstats</span> <span class="op">=</span> <span class="fu">melt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>  <span class="st">'Expectation'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>  <span class="st">'Probability'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">1.75</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mc1000</span><span class="op">$</span><span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">1.75</span><span class="op">)</span></span>
<span><span class="op">)</span>, id.vars <span class="op">=</span> <span class="st">'n'</span><span class="op">)</span></span>
<span><span class="va">realstats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">68</span> <span class="op">/</span> <span class="fl">45</span>, <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">pgamma</a></span><span class="op">(</span><span class="fl">1.75</span>, <span class="fl">68</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Expectation'</span>, <span class="st">'Probability'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">cstats</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">'Estimate'</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">'Number of samples'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>data <span class="op">=</span> <span class="va">realstats</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">stat</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="4_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Since, due to the central limit theorem, estimates of the mean of <span class="math inline">\(\theta^1, \dots,
\theta^S\)</span> (and other quantities??) are approximately normally distributed for large <span class="math inline">\(S\)</span>, we can construct confidence intervals for our estimates based on the sample size.</p>
<p>Specifically, an approximate 95% confidence interval for <span class="math inline">\(\theta\)</span> is</p>
<p><span class="math display">\[
\hat{\theta} \pm 1.96 \sqrt{\hat{\sigma}^2 / S}
\]</span></p>
<p>where <span class="math inline">\(\hat{\sigma}^2\)</span> is the unbiased estimator of the population variance (hence the <em>approximate</em> confidence interval; divide by <span class="math inline">\(S - 1\)</span>, not <span class="math inline">\(S\)</span>). Using this, we can estimate the number of samples we ought to take to report our estimate to a certain degree of precision. We ought to take enough samples such that the standard error <span class="math inline">\(\sqrt{\hat{\sigma}^2/S} &lt; \alpha\)</span> where <span class="math inline">\(\alpha\)</span> is the desired level of precision. Of course, since we don’t know how variable our samples are, we don’t know how big <span class="math inline">\(\hat{\sigma}^2\)</span> is, so we cannot <em>a priori</em> determine the number of samples to run. It is possible, however, to run a smaller number of samples first to determine an estimate of <span class="math inline">\(\hat{\sigma}^2\)</span> and thus the standard error, then conservatively use that estimate to identify the size of <span class="math inline">\(S\)</span> required for the desired precision.</p>
</section></section><section id="posterior-inference-for-arbitrary-functions" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Posterior inference for arbitrary functions</h1>
<p>If we can sample <span class="math inline">\(\theta^{(1)}, \dots, \theta^{(S)} \sim p(\theta \mid y)\)</span> i.i.d., then we can obtain distributions for any arbitrary function <span class="math inline">\(g(\theta)\)</span>. We just need to sample <span class="math inline">\(S\)</span> <span class="math inline">\(\theta^{(i)}\)</span>, then apply <span class="math inline">\(g\)</span> to each <span class="math inline">\(\theta^{(i)}\)</span> to obtain the value of interest, say <span class="math inline">\(\gamma^{(i)}\)</span>. This step is deterministic, so we are actually sampling from <span class="math inline">\(p(\gamma \mid y)\)</span>. Thus, by the sample law of large numbers and central limit theorem derivations as before, Monte Carlo estimations can estimate arbitrary functions to any degree of accuracy. This is very powerful and flexible!</p>
<section id="example-log-odds" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="example-log-odds">
<span class="header-section-number">2.1</span> Example: Log-odds</h2>
<p>Log-odds is the relative likelihood that an event with probability <span class="math inline">\(\theta\)</span> will occur versus not occur. Specifially,</p>
<p><span class="math display">\[\begin{align}
\text{log odds}(\theta) = \log \left( \frac{\theta}{1 - \theta} \right) = \gamma.
\end{align}\]</span></p>
<p>If <span class="math inline">\(\theta = 0.5 = 1 - \theta\)</span> then <span class="math inline">\(\text{log odds}(\theta) = 0\)</span>. If <span class="math inline">\(\theta\)</span> is more likely to happen than not, then <span class="math inline">\(\text{log odds}(\theta) &gt; 0\)</span>. If <span class="math inline">\(\theta\)</span> is less likely to happen than not, then <span class="math inline">\(\text{log odds}(\theta) &lt; 0\)</span>.</p>
<p>We return to surveys. Imagine we survey 860 individuals about agreement with a recent Supreme Court ruling and <span class="math inline">\(y = 441\)</span> say they agreed with the ruling. Say we have a uniform prior on <span class="math inline">\(\theta\)</span> before observing any data, so <span class="math inline">\(\theta \sim \text{Beta}(1, 1)\)</span>.</p>
<p>Notice that, even when given a concrete prior distribution, calculating the prior distribution on <span class="math inline">\(\gamma\)</span> requires actual calculations. They may be managable in this case, but the point is that as functions become far more complicated than the log-odds calculation in this example, even computing a closed form for our prior may be intractable.</p>
<p>So we can do Monte Carlo estimation of prior and posterior distributions of <span class="math inline">\(\gamma\)</span> based on our knowledge about how <span class="math inline">\(\theta\)</span> updates after observing data. Recall that, in our beta-binomial model, if <span class="math inline">\(\theta \sim \text{Beta}(a, b) =
\text{Beta}(1, 1)\)</span>, then <span class="math inline">\(\theta \mid y_1, \dots, y_n \sim \text{Beta}(a + n, b
+ n - y) = \text{Beta}(442, 420)\)</span>.</p>
<p>Notice that our log odds ratio is quite close to 0. Moreover, by leveraging Monte Carlo estimation, we are very (approximately) precise about the precise shape of our prior and posterior distributions, with little mathematical derivation required.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fl">441</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">860</span></span>
<span><span class="va">n.samp</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="va">log.odds</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theta.prior.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="co"># Now compute gammas as a function of theta!</span></span>
<span><span class="va">prior</span> <span class="op">=</span> <span class="fu">log.odds</span><span class="op">(</span><span class="va">theta.prior.mc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theta.post.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span> <span class="op">+</span> <span class="va">y</span>, <span class="va">b</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">posterior</span> <span class="op">=</span> <span class="fu">log.odds</span><span class="op">(</span><span class="va">theta.post.mc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span> <span class="op">=</span> <span class="fu">melt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">posterior</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">combined</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'n'</span>, <span class="st">'type'</span>, <span class="st">'value'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">combined</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">type</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">'gamma'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="example-2-functions-of-two-parameters" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="example-2-functions-of-two-parameters">
<span class="header-section-number">2.2</span> Example 2: Functions of two parameters</h2>
<p>We can now return back to the earlier example with two separate Poisson models of the number of children of women’s without and with bachelor’s degrees. Since <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> are independent, we can sample a pair <span class="math inline">\((\theta^{(i)}_1,
\theta^{(i)}_2)\)</span> from separate samples from <span class="math inline">\(p(\theta_1 \mid y)\)</span> and <span class="math inline">\(p(\theta_2
\mid y)\)</span>, such that many such pairs <span class="math inline">\((\theta^{(i)}_1, \theta^{(i)}_2)\)</span> will (by Monte Carlo estimation) approximate the joint density of <span class="math inline">\(p(\theta_1, \theta_2)\)</span> without needing to calculate or integrate over the joint density by hand. Again,</p>
<p><span class="math display">\[\begin{align}
\left(\theta_1 \;\middle|\; \sum_i Y_{i, 1} = 217\right) &amp;\sim \text{Gamma}(219, 112) \\
\left(\theta_2 \;\middle|\; \sum_i Y_{i, 2} = 217\right) &amp;\sim \text{Gamma}(68, 45)
\end{align}\]</span></p>
<p>the corresponding derivation is thus</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">N</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="va">theta1.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">219</span>, <span class="fl">112</span><span class="op">)</span></span>
<span><span class="va">theta2.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">68</span>, <span class="fl">45</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">theta1.mc</span> <span class="op">&gt;</span> <span class="va">theta2.mc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.974</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Also, like the gamma example above, we can calculate some arbitrary function. Say we are interested in the ratio <span class="math inline">\(f(\theta_1, \theta_2) = \theta_1/\theta_2\)</span> of the means. On average, how many times more children do women without bachelor’s degrees have compared to those with bachelor’s degrees. Then we sample multiple pairs <span class="math inline">\((\theta^{(i)}_1, \theta^{(i)}_2)\)</span>, and multiple pairs <span class="math inline">\(\gamma^i =
f(\theta^{(i)}_1, \theta^{(i)}_2)\)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Common prior</span></span>
<span><span class="va">a</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="co"># Without bachelor's</span></span>
<span><span class="va">n1</span> <span class="op">=</span> <span class="fl">111</span></span>
<span><span class="va">y1</span> <span class="op">=</span> <span class="fl">217</span></span>
<span><span class="co"># With</span></span>
<span><span class="va">n2</span> <span class="op">=</span> <span class="fl">44</span></span>
<span><span class="va">y2</span> <span class="op">=</span> <span class="fl">66</span></span>
<span></span>
<span><span class="va">n.samp</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="va">ratio</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="va">a</span> <span class="op">/</span> <span class="va">b</span> <span class="co"># Not necessary, but good for foramlization</span></span>
<span></span>
<span><span class="co"># Approximate prior distribution for good measure</span></span>
<span><span class="va">prior</span> <span class="op">=</span> <span class="fu">ratio</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">posterior</span> <span class="op">=</span> <span class="fu">ratio</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span> <span class="op">+</span> <span class="va">y1</span>, <span class="va">b</span> <span class="op">+</span> <span class="va">n1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n.samp</span>, <span class="va">a</span> <span class="op">+</span> <span class="va">y2</span>, <span class="va">b</span> <span class="op">+</span> <span class="va">n2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span> <span class="op">=</span> <span class="fu">melt</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">posterior</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">combined</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'n'</span>, <span class="st">'type'</span>, <span class="st">'value'</span><span class="op">)</span></span>
<span><span class="va">combined</span><span class="op">$</span><span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">combined</span><span class="op">$</span><span class="va">type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'prior'</span>, <span class="st">'posterior'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">combined</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">type</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">type</span>, scales <span class="op">=</span> <span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="4_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section></section><section id="sampling-from-predictive-distributions" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Sampling from predictive distributions</h1>
<p>Recall that predictive distributions are distributions of new realizations of a random variable when existing data have been conditioned on and unknown quantities (i.e.&nbsp;parameters) are integrated out.</p>
<p>For example, given a prior distribution <span class="math inline">\(p(\theta)\)</span>, how can we calculate the <em>prior predictive distribution</em> <span class="math inline">\(p(\tilde{y})\)</span>? Often we have an analytical solution for the form a posterior predictive distribution for a given model. But often we can simply sample many <span class="math inline">\(\theta^{(i)}\)</span> from our posterior distribution on <span class="math inline">\(\theta\)</span>, and then sample a <span class="math inline">\(y^{(i)}\)</span> for each <span class="math inline">\(\theta^{(i)}\)</span>. Specifically, <span class="math inline">\(\{(\theta,
\tilde{y}) \}^{(1)}, \dots, (\theta, \tilde{y})^{(S)} \}\)</span> are samples from the joint posterior distribution of <span class="math inline">\(\theta, \tilde{Y}\)</span>, and the sequence <span class="math inline">\(\{\tilde{y}^{(1)},
\dots, \tilde{y}^{(S)}\}\)</span> are samples from the <em>marginal</em> posterior distribution of <span class="math inline">\(\tilde{Y}\)</span> (if we had an infinite number of samples, we would be “summing” over all theta).</p>
</section><section id="posterior-predictive-model-checking" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Posterior predictive model checking</h1>
<p>Because exercises 4.3 and 4.8 address this, I’m skipping this section for now.</p>
</section><section id="exercises" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Exercises</h1>
<section id="section" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="section">
<span class="header-section-number">5.1</span> 4.1</h2>
<p>For the county in exercise 3.1, <span class="math inline">\(\theta_3 \mid \sum Y_i = y \sim \text{Beta}(58,
44)\)</span>.</p>
<p>For this county, assuming a uniform prior, <span class="math inline">\(\theta_4 \mid \sum Y_i = y \sim
\text{Beta}(31, 21)\)</span>.</p>
<p>So,</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta1.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">58</span>, <span class="fl">44</span><span class="op">)</span></span>
<span><span class="va">theta2.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">31</span>, <span class="fl">21</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">theta1.mc</span> <span class="op">&lt;</span> <span class="va">theta2.mc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6272</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section><section id="section-1" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="section-1">
<span class="header-section-number">5.2</span> 4.2</h2>
<section id="a" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="a">
<span class="header-section-number">5.2.1</span> a</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta.a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">237</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">theta.b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">125</span>, <span class="fl">14</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">theta.b</span> <span class="op">&lt;</span> <span class="va">theta.a</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9944</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section><section id="b" class="level3" data-number="5.2.2"><h3 data-number="5.2.2" class="anchored" data-anchor-id="b">
<span class="header-section-number">5.2.2</span> b</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n0</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="va">exps</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">n0</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="op">(</span><span class="fl">12</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span> <span class="fl">113</span>, <span class="va">n</span> <span class="op">+</span> <span class="fl">13</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">237</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">exps</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'point'</span>, <span class="st">'smooth'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="4_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Even a strong factor of <span class="math inline">\(n_0\)</span> has a relatively minimal effect on the posterior distribution.</p>
</section><section id="c" class="level3" data-number="5.2.3"><h3 data-number="5.2.3" class="anchored" data-anchor-id="c">
<span class="header-section-number">5.2.3</span> c</h3>
<p>Recall for a Poisson model, the posterior predictive distribution after a <span class="math inline">\(\text{Gamma}(a, b)\)</span> prior is a negative binomial distribution <span class="math inline">\(\text{NB}(a +
\sum y_i, b, n)\)</span>. (The posterior predictive parameters are the same as those of the posterior distribution itself). However, we can also simulate it by sampling from the Poisson distribution implied by the sampled theta.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n0</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="va">N</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">n0</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">theta.a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">237</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="va">theta.b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="op">(</span><span class="fl">12</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span> <span class="fl">113</span>, <span class="va">n</span> <span class="op">+</span> <span class="fl">13</span><span class="op">)</span></span>
<span>  <span class="va">y.a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">theta.a</span><span class="op">)</span></span>
<span>  <span class="va">y.b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">theta.b</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y.b</span> <span class="op">&lt;</span> <span class="va">y.a</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="va">ys</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'point'</span>, <span class="st">'smooth'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="4_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Which appears to be a different relationship - exactly what it is could be calculated by integrating the quantity using the posterior distribution, then figuring out what the shape is as a function of <span class="math inline">\(n_0\)</span>.</p>
</section></section><section id="section-2" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="section-2">
<span class="header-section-number">5.3</span> 4.3</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ya</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">14</span>, <span class="fl">13</span>, <span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">yb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">10</span>, <span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="a-1" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="a-1">
<span class="header-section-number">5.3.1</span> a</h3>
<p>Using <code>ya</code>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ya</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ya</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">theta1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="va">t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span></span>
<span>  <span class="va">t</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="va">ts</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ya</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ya</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="4_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Since the observed statistic (vertical line) is centered well within the standard spread of the observed <span class="math inline">\(t(s)\)</span>, we have no reason to believe the fit of the Poisson model is bad. Also, since <span class="math inline">\(t(s)\)</span> depends on the only parameter of the data <span class="math inline">\(\theta\)</span>, it can thus be inferred that the Poisson model seems to fit reasonably in this case.</p>
</section><section id="b-1" class="level3" data-number="5.3.2"><h3 data-number="5.3.2" class="anchored" data-anchor-id="b-1">
<span class="header-section-number">5.3.2</span> b</h3>
<p>Using <code>yb</code>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yb</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">yb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">theta2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="va">t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ys</span><span class="op">)</span></span>
<span>  <span class="va">t</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="va">ts</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yb</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">yb</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="4_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Since the observed statistic (vertical line) seems to be an outlier for the range of statistics normally seen in this dataset, we can infer that the Poisson model does not seem to fit this dataset well.</p>
</section></section><section id="section-3" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="section-3">
<span class="header-section-number">5.4</span> 4.6</h2>
<section id="via-monte-carlo-sampling" class="level3" data-number="5.4.1"><h3 data-number="5.4.1" class="anchored" data-anchor-id="via-monte-carlo-sampling">
<span class="header-section-number">5.4.1</span> via Monte-Carlo sampling</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">gamma.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">theta.mc</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">theta</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>gamma <span class="op">=</span> <span class="va">gamma.mc</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gamma</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="4_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Yes, the prior for <span class="math inline">\(\gamma\)</span> is centered around 0 and appears to be normally distributed. Naturally, <span class="math inline">\(p(\gamma)\)</span> must be centered around something, since you cannot have a uniform distribution on an infinite interval.</p>
</section><section id="analytically" class="level3" data-number="5.4.2"><h3 data-number="5.4.2" class="anchored" data-anchor-id="analytically">
<span class="header-section-number">5.4.2</span> analytically</h3>
<p>This is computed in Exercise 3.10 (a).</p>
</section></section><section id="section-4" class="level2" data-number="5.5"><h2 data-number="5.5" class="anchored" data-anchor-id="section-4">
<span class="header-section-number">5.5</span> 4.7</h2>
<section id="a-2" class="level3" data-number="5.5.1"><h3 data-number="5.5.1" class="anchored" data-anchor-id="a-2">
<span class="header-section-number">5.5.1</span> a</h3>
<p>We first sample <span class="math inline">\((\theta, \sigma^2)\)</span> via sampling from <span class="math inline">\(p(\sigma^2)\)</span> and then <span class="math inline">\(p(\theta \mid \sigma^2)\)</span>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">N</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="va">sigma2.mc</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">theta.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">4.1</span>, <span class="va">sigma2.mc</span> <span class="op">/</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Now we can sample according to the mixture posterior distribution:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Don't forget about sqrt!</span></span>
<span><span class="va">sigma.mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sigma2.mc</span><span class="op">)</span></span>
<span><span class="va">ynew.mc</span> <span class="op">=</span> <span class="fl">.31</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">theta.mc</span>, <span class="va">sigma.mc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">.46</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">theta.mc</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">sigma.mc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">.23</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">3</span> <span class="op">*</span> <span class="va">theta.mc</span>, <span class="fl">3</span> <span class="op">*</span> <span class="va">sigma.mc</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ynew.mc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="4_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="b-2" class="level3" data-number="5.5.2"><h3 data-number="5.5.2" class="anchored" data-anchor-id="b-2">
<span class="header-section-number">5.5.2</span> b</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ynew.mc</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.125</span>, <span class="fl">.875</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    12.5%    87.5% </span></span>
<span><span class="co">#&gt; 7.154498 8.588006</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section><section id="c-1" class="level3" data-number="5.5.3"><h3 data-number="5.5.3" class="anchored" data-anchor-id="c-1">
<span class="header-section-number">5.5.3</span> c</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># i. Compute and normalize density</span></span>
<span><span class="va">dens</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">ynew.mc</span><span class="op">)</span></span>
<span><span class="va">dens.ynorm</span> <span class="op">=</span> <span class="va">dens</span><span class="op">$</span><span class="va">y</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">dens</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co"># ii. Sort in decreasing order</span></span>
<span><span class="va">dens.ynorm.desc</span> <span class="op">=</span> <span class="va">dens.ynorm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">dens.ynorm</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># iii. Find first probability value st cumsum of sorted values &gt; 0.75</span></span>
<span><span class="va">cutoff</span> <span class="op">=</span> <span class="va">dens.ynorm.desc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">dens.ynorm.desc</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">in.hdp</span> <span class="op">=</span> <span class="va">dens.ynorm</span> <span class="op">&gt;</span> <span class="va">cutoff</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dens</span><span class="op">$</span><span class="va">x</span>, density <span class="op">=</span> <span class="va">dens.ynorm</span>, hdp <span class="op">=</span> <span class="va">in.hdp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">hdp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="4_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">dens</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">in.hdp</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">in.hdp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 7.149927 8.573269</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Since the distribution of weights is relatively symmetric and normally distributed, the HDP and quantile confidence intervals are quite similar.</p>
</section><section id="d" class="level3" data-number="5.5.4"><h3 data-number="5.5.4" class="anchored" data-anchor-id="d">
<span class="header-section-number">5.5.4</span> d</h3>
<p>Perhaps a combination of multiple parts of a vegetable which have known distributions (e.g.&nbsp;stem, fruit, leaves, etc)</p>
</section></section><section id="section-5" class="level2" data-number="5.6"><h2 data-number="5.6" class="anchored" data-anchor-id="section-5">
<span class="header-section-number">5.6</span> 4.8</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">menchild30bach</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html">scan</a></span><span class="op">(</span><span class="st">'Exercises/menchild30bach.dat'</span><span class="op">)</span></span>
<span><span class="va">menchild30nobach</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scan.html">scan</a></span><span class="op">(</span><span class="st">'Exercises/menchild30nobach.dat'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="a-3" class="level3" data-number="5.6.1"><h3 data-number="5.6.1" class="anchored" data-anchor-id="a-3">
<span class="header-section-number">5.6.1</span> a</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">N</span> <span class="op">=</span> <span class="fl">5000</span></span>
<span></span>
<span><span class="va">thetaA</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">a</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">menchild30bach</span><span class="op">)</span>, <span class="va">b</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">menchild30bach</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">thetaB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">a</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">menchild30nobach</span><span class="op">)</span>, <span class="va">b</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">menchild30nobach</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ynewA</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">thetaA</span><span class="op">)</span></span>
<span><span class="va">ynewB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">thetaB</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pos.predict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  ynew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ynewA</span>, <span class="va">ynewB</span><span class="op">)</span>,</span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bach'</span>, <span class="st">'nobach'</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">N</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bach'</span>, <span class="st">'nobach'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'posterior'</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pos.predict</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ynew</span>, group <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">dist</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="4_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="b-3" class="level3" data-number="5.6.2"><h3 data-number="5.6.2" class="anchored" data-anchor-id="b-3">
<span class="header-section-number">5.6.2</span> b</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta.diff</span> <span class="op">=</span> <span class="va">thetaB</span> <span class="op">-</span> <span class="va">thetaA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Theta difference:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Theta difference:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">theta.diff</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.1372451 0.7406251</span></span>
<span></span>
<span><span class="va">ynew.diff</span> <span class="op">=</span> <span class="va">ynewB</span> <span class="op">-</span> <span class="va">ynewA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Ynew difference:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Ynew difference:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ynew.diff</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  2.5% 97.5% </span></span>
<span><span class="co">#&gt;    -2     4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Since the confidence interval for <span class="math inline">\(\theta_B - \theta_A\)</span> does not contain zero, we believe with at least approximately 95% probability that the true posterior mean <span class="math inline">\(\theta_B\)</span> is greater than <span class="math inline">\(\theta_A\)</span>. However, the same does not hold true for the means of the difference between two individuals sampled from this distribution, due to the increased uncertainty in the posterior predictive distribution.</p>
</section><section id="c-2" class="level3" data-number="5.6.3"><h3 data-number="5.6.3" class="anchored" data-anchor-id="c-2">
<span class="header-section-number">5.6.3</span> c</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">emp.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  ynew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">menchild30bach</span>, <span class="va">menchild30nobach</span><span class="op">)</span>,</span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'bach'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">menchild30bach</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'nobach'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">menchild30nobach</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bach'</span>, <span class="st">'nobach'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'empirical'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">total.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">pos.predict</span>, <span class="va">emp.df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">total.df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ynew</span>, y <span class="op">=</span> <span class="va">..density..</span>, group <span class="op">=</span> <span class="va">type</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>position <span class="op">=</span> <span class="st">'dodge'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">dist</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="4_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The posterior distribution for <span class="math inline">\(\tilde{Y}_B\)</span> seems to peak around 1, while the empirical distribution peaks strongly around 0. Thus I think this is an error in the model fit.</p>
<p>(Observe that the mean of the nobach population is around 1.4)</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ynewB</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.3866</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section><section id="d-1" class="level3" data-number="5.6.4"><h3 data-number="5.6.4" class="anchored" data-anchor-id="d-1">
<span class="header-section-number">5.6.4</span> d</h3>
<p>Model checking, by computing a statistic that may be of interest:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Show R code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">zeroandone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">thetaB</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">218</span>, <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="va">n0s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nB</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">n1s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nB</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n0s</span>, <span class="va">n1s</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">zeros</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">zeroandone</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="va">t</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ones</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">zeroandone</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="va">t</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>zeros <span class="op">=</span> <span class="va">zeros</span>, ones <span class="op">=</span> <span class="va">ones</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">zeros</span>, y <span class="op">=</span> <span class="va">ones</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">'point'</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">menchild30nobach</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">menchild30nobach</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="4_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="4_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The observed statistic is in red. Notice how it seems somewhat abnormal for sample datasets from our poisson model with <span class="math inline">\(\theta = 1.4\)</span> especially in the case of the number of ones observed. This is a clear indicator that the fit of our Poisson model is suboptimal.</p>


<!-- -->

</section></section></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/d-morrison\.github\.io\/hoff-bayesian-statistics\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 4: Monte Carlo approximation"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Jesse Mu"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "September 28, 2016"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Setup --&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, message=FALSE}</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.align =</span> <span class="st">'center'</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Begin writing --&gt;</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>Why Monte Carlo? Often we want to calculate either arbitrary properties of</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>posterior distributions or complex posterior distributions themselves. Often,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>clean analytical solutions for posterior distributions are difficult to obtain.</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>By using computational methods, we can approximate arbitrarily complex posterior</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>probability calculations by repeatedly sampling posteriors. Such techniques are</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>known as Monte Carlo methods.</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Monte Carlo method</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>We continue the last chapter, where we found posterior distributions for women</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>without ($\theta_1$) and with bachelor's degrees ($\theta_2$). Recall</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>\left(\theta_1 \;\middle|\; \sum_i Y_{i, 1} = 217\right) &amp;\sim \text{Gamma}(219, 112) <span class="sc">\\</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>\left(\theta_2 \;\middle|\; \sum_i Y_{i, 2} = 217\right) &amp;\sim \text{Gamma}(68, 45)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">=</span> <span class="dv">111</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>sy1 <span class="ot">=</span> <span class="dv">217</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">=</span> <span class="dv">44</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>sy2 <span class="ot">=</span> <span class="dv">66</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.01</span>), a, b),</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos.theta1 =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.01</span>), a <span class="sc">+</span> sy1, b <span class="sc">+</span> n1),</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos.theta2 =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.01</span>), a <span class="sc">+</span> sy2, b <span class="sc">+</span> n2)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>df.long <span class="ot">=</span> <span class="fu">melt</span>(df, <span class="at">id.vars =</span> <span class="st">'theta'</span>, <span class="at">variable_name =</span> <span class="st">'dist'</span>)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.long, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value, <span class="at">group =</span> dist, <span class="at">color =</span> dist)) <span class="sc">+</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'probability'</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>To calculate the probability under these models that the mean number of children of women</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>without bachelor's degrees are higher than the mean number of those with </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>bachelor's degrees $P(\theta_1 &gt; \theta_2 \mid \dots)$, we can do so</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>analytically. Notice that since $\theta_1$ and $\theta_2$ are independent,</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>$p(\theta_1, \theta_2) = p(\theta_1) p(\theta_2)$. If we plot $\theta_1$ and </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>$\theta_2$ on the cartesian coordinate plane, the line $\theta_1 = \theta_2$ </span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>divides two regions of the plane - one where $\theta_1 &gt; \theta_2$, the </span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>other where $\theta_2 &gt; \theta_1$. We double-integrate the joint density </span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>$p(\theta_1, \theta_2)$ over the region we're interested in.</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>Since for this example, the supports of $\theta_1$ and $\theta_2$ are $[0,</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>\infty]$, we integrate over a portion of that region up to the line $\theta_1 = \theta_2$:</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>P(\theta_1 &gt; \theta_2 \mid y) &amp;= \int_0^\infty \left( \int_0^{\theta_1}</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>p(\theta_1 \mid y) p(\theta_2 \mid y) \; d\theta_2 \right) \; d\theta_1 <span class="sc">\\</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>&amp;= \int_0^\infty \left( \int_0^{\theta_1}</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>\text{dgamma}(\theta_1, 219, 112) \times \text{dgamma}(\theta_2, 68, 45) \; d\theta_2 \right) \; d\theta_1 <span class="sc">\\</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>Since Gamma distributions have well-defined PDFs, in this case the integral is</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>computable and is reasonably easy in R:</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>inner.int <span class="ot">=</span> <span class="cf">function</span>(Theta<span class="fl">.1</span>) {</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(Theta<span class="fl">.1</span>, <span class="cf">function</span>(theta<span class="fl">.1</span>) {</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">integrate</span>(<span class="cf">function</span>(theta<span class="fl">.2</span>) <span class="fu">dgamma</span>(theta<span class="fl">.1</span>, <span class="dv">219</span>, <span class="dv">112</span>) <span class="sc">*</span> <span class="fu">dgamma</span>(theta<span class="fl">.2</span>, <span class="dv">68</span>, <span class="dv">45</span>), <span class="dv">0</span>, theta<span class="fl">.1</span>)<span class="sc">$</span>value</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="fu">integrate</span>(inner.int, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>However, when inference gets complicated, integrals may not be tractable.</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>Alternatively, we can estimate via *Monte Carlo estimation*.</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>Notice that we can implement computational tools that allow us to sample</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>arbitrarily from the Gamma distributions of $\theta_1$ and $\theta_2$. The </span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>details of implementing these samplers, i.e. functions that can draw some </span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>$\theta_i \sim p(\theta \mid y)$, are non-trivial - for an example of </span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>algorithmically sampling from a Normal distribution given just pseudo-random number generators, see the [Box-Muller </span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>transform](http://www.math.nyu.edu/faculty/goodman/teaching/MonteCarlo2005/notes/GaussianSampling.pdf).</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>However,</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>we will assume that we have these functions implemented. For example, in R we </span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>can represent $n$ random draws from a gamma distribution with parameters $a$ and</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>$b$ with the function call <span class="in">`rgamma(n, a, b)`</span>.</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>The law of large numbers states that, for $S$ i.i.d. draws $\theta^1, \dots,</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>\theta^S$ from a distribution $p(\theta)$, as $S \rightarrow \infty$,</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>$\frac{1}{S} \sum \theta^i \rightarrow \mathbb{E}(p(\theta))$. This also implies that the</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>variance of the sample approaches the variance of the distribution (to calcualte</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>this, expand the formula for the variance of $\theta$ into a combination of</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>expectations, then use the law of large numbers of the expectations).</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>Indeed, by a more advanced theorem known as the Glivenko-Cantelli Lemma, the</span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>empirical distribution function of $\theta^1, \dots, \theta^S$ approaches</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>$p(\theta)$. So more generally, we can approximate any quantity of interest of</span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>$p(\theta)$ to arbitrary precision using a large enough sample from that</span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>function. This is visible in the image below, which demonstrates how the</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a>histogram and kernel density estimates of larger and large samples from the</span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a>$\theta_2 \sim \text{Gamma}(68, 45)$ distribution approach the distribution</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>itself. In each panel, the true distribution is the dotted blue line.</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">68</span></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">45</span></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>std.gamma <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.01</span>), <span class="at">p =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.01</span>), a, b))</span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a>mc10 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> <span class="fu">rgamma</span>(<span class="dv">10</span>, a, b), <span class="at">type =</span> <span class="st">'10 samples'</span>)</span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a>mc100 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> <span class="fu">rgamma</span>(<span class="dv">100</span>, a, b), <span class="at">type =</span> <span class="st">'100 samples'</span>)</span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a>mc1000 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, a, b), <span class="at">type =</span> <span class="st">'1000 samples'</span>)</span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>mcs <span class="ot">=</span> <span class="fu">rbind</span>(mc10, mc100, mc1000)</span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mcs, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> std.gamma, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> p), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'blue'</span>) <span class="sc">+</span></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'density'</span>) <span class="sc">+</span></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> type)</span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical evaluation</span></span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a>The actual posterior mean of $\theta_2 \mid y$ is $68/45 = 1.51$. Notice we can</span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a>approximate this mean with the mean of the above</span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a>means <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'10 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc10<span class="sc">$</span>theta),</span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a>          <span class="st">'100 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc100<span class="sc">$</span>theta),</span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a>          <span class="st">'1000 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc1000<span class="sc">$</span>theta))</span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(means, <span class="at">col.names =</span> <span class="st">'Estimate of E(theta)'</span>)</span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a>We can calculate probabilities of events concerning theta by counting the number</span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a>of times in our sample the randomly sampled value satisfies the event. For</span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a>example, to calculate $P(\theta &lt; 1.75 \mid y)$, we observe the number of times</span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a>a sampled $\theta^{i} &lt; 1.75$. In R, comparison operators like <span class="in">`&gt;`</span> or <span class="in">`==`</span></span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a>operate element-wise, so <span class="in">`mc1000$theta &lt; 1.75`</span> returns a boolean vector of <span class="in">`T`</span>s</span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a>and <span class="in">`F`</span>s depending on whether the specific $\theta^i$ is indeed less than 1.75:</span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a>Thus, we can calculate</span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a>means <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'10 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc10<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="fl">1.75</span>),</span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a>          <span class="st">'100 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc100<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="fl">1.75</span>),</span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a>          <span class="st">'1000 samples'</span> <span class="ot">=</span> <span class="fu">mean</span>(mc1000<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="fl">1.75</span>))</span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(means, <span class="at">col.names =</span> <span class="st">'Estimate of P(theta &lt; 1.75)'</span>)</span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-172"><a href="#cb28-172" aria-hidden="true" tabindex="-1"></a>Notice the true probability can be calculated with via <span class="in">`pgamma(1.75, 68, 45)`</span> and is <span class="in">`r round(pgamma(1.75, 68, 45), 3)`</span>.</span>
<span id="cb28-173"><a href="#cb28-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Convergence</span></span>
<span id="cb28-175"><a href="#cb28-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-176"><a href="#cb28-176" aria-hidden="true" tabindex="-1"></a>We can measure how quickly our estimates converge to the true mean (for this</span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a>example, when the true mean is known) by plotting the estimate thus far as the</span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a>number of samples in our estimation increase, as below:</span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-183"><a href="#cb28-183" aria-hidden="true" tabindex="-1"></a>cstats <span class="ot">=</span> <span class="fu">melt</span>(<span class="fu">data.frame</span>(</span>
<span id="cb28-184"><a href="#cb28-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq_along</span>(mc1000<span class="sc">$</span>theta),</span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Expectation'</span> <span class="ot">=</span> <span class="fu">cumsum</span>(mc1000<span class="sc">$</span>theta) <span class="sc">/</span> <span class="fu">seq_along</span>(mc1000<span class="sc">$</span>theta),</span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Probability'</span> <span class="ot">=</span> <span class="fu">cumsum</span>(mc1000<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="fl">1.75</span>) <span class="sc">/</span> <span class="fu">seq_along</span>(mc1000<span class="sc">$</span>theta <span class="sc">&lt;</span> <span class="fl">1.75</span>)</span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a>), <span class="at">id.vars =</span> <span class="st">'n'</span>)</span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a>realstats <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="fu">c</span>(<span class="dv">68</span> <span class="sc">/</span> <span class="dv">45</span>, <span class="fu">pgamma</span>(<span class="fl">1.75</span>, <span class="dv">68</span>, <span class="dv">45</span>)),</span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">'Expectation'</span>, <span class="st">'Probability'</span>)</span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cstats, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb28-193"><a href="#cb28-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">'free'</span>) <span class="sc">+</span></span>
<span id="cb28-194"><a href="#cb28-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Estimate'</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">'Number of samples'</span>) <span class="sc">+</span></span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> realstats, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> stat), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb28-197"><a href="#cb28-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-198"><a href="#cb28-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-199"><a href="#cb28-199" aria-hidden="true" tabindex="-1"></a>Since, due to the central limit theorem, estimates of the mean of $\theta^1, \dots,</span>
<span id="cb28-200"><a href="#cb28-200" aria-hidden="true" tabindex="-1"></a>\theta^S$ (and other quantities??) are approximately normally distributed for</span>
<span id="cb28-201"><a href="#cb28-201" aria-hidden="true" tabindex="-1"></a>large $S$, we can construct confidence intervals for our estimates based on the</span>
<span id="cb28-202"><a href="#cb28-202" aria-hidden="true" tabindex="-1"></a>sample size.</span>
<span id="cb28-203"><a href="#cb28-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-204"><a href="#cb28-204" aria-hidden="true" tabindex="-1"></a>Specifically, an approximate 95% confidence interval for $\theta$ is</span>
<span id="cb28-205"><a href="#cb28-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-206"><a href="#cb28-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb28-207"><a href="#cb28-207" aria-hidden="true" tabindex="-1"></a>\hat{\theta} \pm 1.96 \sqrt{\hat{\sigma}^2 / S}</span>
<span id="cb28-208"><a href="#cb28-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb28-209"><a href="#cb28-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-210"><a href="#cb28-210" aria-hidden="true" tabindex="-1"></a>where $\hat{\sigma}^2$ is the unbiased estimator of the population variance </span>
<span id="cb28-211"><a href="#cb28-211" aria-hidden="true" tabindex="-1"></a>(hence the *approximate* confidence interval; divide by $S - 1$, not $S$). Using</span>
<span id="cb28-212"><a href="#cb28-212" aria-hidden="true" tabindex="-1"></a>this, we can estimate the number of samples we ought to take to report our estimate</span>
<span id="cb28-213"><a href="#cb28-213" aria-hidden="true" tabindex="-1"></a>to a certain degree of precision. We ought to take enough samples such that the </span>
<span id="cb28-214"><a href="#cb28-214" aria-hidden="true" tabindex="-1"></a>standard error $\sqrt{\hat{\sigma}^2/S} &lt; \alpha$ where $\alpha$ is the desired </span>
<span id="cb28-215"><a href="#cb28-215" aria-hidden="true" tabindex="-1"></a>level of precision. Of course, since we don't know how variable our samples are,</span>
<span id="cb28-216"><a href="#cb28-216" aria-hidden="true" tabindex="-1"></a>we don't know how big $\hat{\sigma}^2$ is, so we cannot *a priori* determine the</span>
<span id="cb28-217"><a href="#cb28-217" aria-hidden="true" tabindex="-1"></a>number of samples to run. It is possible, however, to run a smaller number of </span>
<span id="cb28-218"><a href="#cb28-218" aria-hidden="true" tabindex="-1"></a>samples first to determine an estimate of $\hat{\sigma}^2$ and thus the standard</span>
<span id="cb28-219"><a href="#cb28-219" aria-hidden="true" tabindex="-1"></a>error, then conservatively use that estimate to identify the size of $S$ </span>
<span id="cb28-220"><a href="#cb28-220" aria-hidden="true" tabindex="-1"></a>required for the desired precision.</span>
<span id="cb28-221"><a href="#cb28-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-222"><a href="#cb28-222" aria-hidden="true" tabindex="-1"></a><span class="fu"># Posterior inference for arbitrary functions</span></span>
<span id="cb28-223"><a href="#cb28-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-224"><a href="#cb28-224" aria-hidden="true" tabindex="-1"></a>If we can sample $\theta^{(1)}, \dots, \theta^{(S)} \sim p(\theta \mid y)$ i.i.d., then</span>
<span id="cb28-225"><a href="#cb28-225" aria-hidden="true" tabindex="-1"></a>we can obtain distributions for any arbitrary function $g(\theta)$. We just need</span>
<span id="cb28-226"><a href="#cb28-226" aria-hidden="true" tabindex="-1"></a>to sample $S$ $\theta^{(i)}$, then apply $g$ to each $\theta^{(i)}$ to obtain the value</span>
<span id="cb28-227"><a href="#cb28-227" aria-hidden="true" tabindex="-1"></a>of interest, say $\gamma^{(i)}$. This step is deterministic, so we are actually</span>
<span id="cb28-228"><a href="#cb28-228" aria-hidden="true" tabindex="-1"></a>sampling from $p(\gamma \mid y)$. Thus, by the sample law of large numbers and</span>
<span id="cb28-229"><a href="#cb28-229" aria-hidden="true" tabindex="-1"></a>central limit theorem derivations as before, Monte Carlo estimations can</span>
<span id="cb28-230"><a href="#cb28-230" aria-hidden="true" tabindex="-1"></a>estimate arbitrary functions to any degree of accuracy. This is very powerful</span>
<span id="cb28-231"><a href="#cb28-231" aria-hidden="true" tabindex="-1"></a>and flexible!</span>
<span id="cb28-232"><a href="#cb28-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-233"><a href="#cb28-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example: Log-odds</span></span>
<span id="cb28-234"><a href="#cb28-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-235"><a href="#cb28-235" aria-hidden="true" tabindex="-1"></a>Log-odds is the relative likelihood that an event with probability $\theta$ will</span>
<span id="cb28-236"><a href="#cb28-236" aria-hidden="true" tabindex="-1"></a>occur versus not occur. Specifially,</span>
<span id="cb28-237"><a href="#cb28-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-238"><a href="#cb28-238" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb28-239"><a href="#cb28-239" aria-hidden="true" tabindex="-1"></a>\text{log odds}(\theta) = \log \left( \frac{\theta}{1 - \theta} \right) = \gamma.</span>
<span id="cb28-240"><a href="#cb28-240" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb28-241"><a href="#cb28-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-242"><a href="#cb28-242" aria-hidden="true" tabindex="-1"></a>If $\theta = 0.5 = 1 - \theta$ then $\text{log odds}(\theta) = 0$. If $\theta$</span>
<span id="cb28-243"><a href="#cb28-243" aria-hidden="true" tabindex="-1"></a>is more likely to happen than not, then $\text{log odds}(\theta) &gt; 0$. If</span>
<span id="cb28-244"><a href="#cb28-244" aria-hidden="true" tabindex="-1"></a>$\theta$ is less likely to happen than not, then $\text{log odds}(\theta) &lt; 0$.</span>
<span id="cb28-245"><a href="#cb28-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-246"><a href="#cb28-246" aria-hidden="true" tabindex="-1"></a>We return to surveys. Imagine we survey 860 individuals about agreement with a</span>
<span id="cb28-247"><a href="#cb28-247" aria-hidden="true" tabindex="-1"></a>recent Supreme Court ruling and $y = 441$ say they agreed with the ruling. Say</span>
<span id="cb28-248"><a href="#cb28-248" aria-hidden="true" tabindex="-1"></a>we have a uniform prior on $\theta$ before observing any data, so $\theta \sim \text{Beta}(1, 1)$.</span>
<span id="cb28-249"><a href="#cb28-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-250"><a href="#cb28-250" aria-hidden="true" tabindex="-1"></a>Notice that, even when given a concrete prior distribution, calculating the</span>
<span id="cb28-251"><a href="#cb28-251" aria-hidden="true" tabindex="-1"></a>prior distribution on $\gamma$ requires actual calculations. They may be</span>
<span id="cb28-252"><a href="#cb28-252" aria-hidden="true" tabindex="-1"></a>managable in this case, but the point is that as functions become far more</span>
<span id="cb28-253"><a href="#cb28-253" aria-hidden="true" tabindex="-1"></a>complicated than the log-odds calculation in this example, even computing a</span>
<span id="cb28-254"><a href="#cb28-254" aria-hidden="true" tabindex="-1"></a>closed form for our prior may be intractable.</span>
<span id="cb28-255"><a href="#cb28-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-256"><a href="#cb28-256" aria-hidden="true" tabindex="-1"></a>So we can do Monte Carlo estimation of prior and posterior distributions of</span>
<span id="cb28-257"><a href="#cb28-257" aria-hidden="true" tabindex="-1"></a>$\gamma$ based on our knowledge about how $\theta$ updates after observing data.</span>
<span id="cb28-258"><a href="#cb28-258" aria-hidden="true" tabindex="-1"></a>Recall that, in our beta-binomial model, if $\theta \sim \text{Beta}(a, b) =</span>
<span id="cb28-259"><a href="#cb28-259" aria-hidden="true" tabindex="-1"></a>\text{Beta}(1, 1)$, then $\theta \mid y_1, \dots, y_n \sim \text{Beta}(a + n, b</span>
<span id="cb28-260"><a href="#cb28-260" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>n - y) = \text{Beta}(442, 420)$.</span>
<span id="cb28-261"><a href="#cb28-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-262"><a href="#cb28-262" aria-hidden="true" tabindex="-1"></a>Notice that our log odds ratio is quite close to 0. Moreover, by leveraging</span>
<span id="cb28-263"><a href="#cb28-263" aria-hidden="true" tabindex="-1"></a>Monte Carlo estimation, we are very (approximately) precise about the precise</span>
<span id="cb28-264"><a href="#cb28-264" aria-hidden="true" tabindex="-1"></a>shape of our prior and posterior distributions, with little mathematical derivation required.</span>
<span id="cb28-265"><a href="#cb28-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-268"><a href="#cb28-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-269"><a href="#cb28-269" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb28-270"><a href="#cb28-270" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb28-271"><a href="#cb28-271" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">441</span></span>
<span id="cb28-272"><a href="#cb28-272" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">860</span></span>
<span id="cb28-273"><a href="#cb28-273" aria-hidden="true" tabindex="-1"></a>n.samp <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb28-274"><a href="#cb28-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-275"><a href="#cb28-275" aria-hidden="true" tabindex="-1"></a>log.odds <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x))</span>
<span id="cb28-276"><a href="#cb28-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-277"><a href="#cb28-277" aria-hidden="true" tabindex="-1"></a>theta.prior.mc <span class="ot">=</span> <span class="fu">rbeta</span>(n.samp, a, b)</span>
<span id="cb28-278"><a href="#cb28-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Now compute gammas as a function of theta!</span></span>
<span id="cb28-279"><a href="#cb28-279" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">=</span> <span class="fu">log.odds</span>(theta.prior.mc)</span>
<span id="cb28-280"><a href="#cb28-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-281"><a href="#cb28-281" aria-hidden="true" tabindex="-1"></a>theta.post.mc <span class="ot">=</span> <span class="fu">rbeta</span>(n.samp, a <span class="sc">+</span> y, b <span class="sc">+</span> n <span class="sc">-</span> y)</span>
<span id="cb28-282"><a href="#cb28-282" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">=</span> <span class="fu">log.odds</span>(theta.post.mc)</span>
<span id="cb28-283"><a href="#cb28-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-284"><a href="#cb28-284" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">=</span> <span class="fu">melt</span>(<span class="fu">cbind</span>(prior, posterior))</span>
<span id="cb28-285"><a href="#cb28-285" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(combined) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'n'</span>, <span class="st">'type'</span>, <span class="st">'value'</span>)</span>
<span id="cb28-286"><a href="#cb28-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-287"><a href="#cb28-287" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">group =</span> type, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb28-288"><a href="#cb28-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-289"><a href="#cb28-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb28-290"><a href="#cb28-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'gamma'</span>)</span>
<span id="cb28-291"><a href="#cb28-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-292"><a href="#cb28-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-293"><a href="#cb28-293" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 2: Functions of two parameters</span></span>
<span id="cb28-294"><a href="#cb28-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-295"><a href="#cb28-295" aria-hidden="true" tabindex="-1"></a>We can now return back to the earlier example with two separate Poisson models </span>
<span id="cb28-296"><a href="#cb28-296" aria-hidden="true" tabindex="-1"></a>of the number of children of women's without and with bachelor's degrees. Since</span>
<span id="cb28-297"><a href="#cb28-297" aria-hidden="true" tabindex="-1"></a>$\theta_1$ and $\theta_2$ are independent, we can sample a pair $(\theta^{(i)}_1,</span>
<span id="cb28-298"><a href="#cb28-298" aria-hidden="true" tabindex="-1"></a>\theta^{(i)}_2)$ from separate samples from $p(\theta_1 \mid y)$ and $p(\theta_2</span>
<span id="cb28-299"><a href="#cb28-299" aria-hidden="true" tabindex="-1"></a>\mid y)$, such that many such pairs $(\theta^{(i)}_1, \theta^{(i)}_2)$ will (by Monte</span>
<span id="cb28-300"><a href="#cb28-300" aria-hidden="true" tabindex="-1"></a>Carlo estimation) approximate the joint density of $p(\theta_1, \theta_2)$</span>
<span id="cb28-301"><a href="#cb28-301" aria-hidden="true" tabindex="-1"></a>without needing to calculate or integrate over the joint density by hand. Again,</span>
<span id="cb28-302"><a href="#cb28-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-303"><a href="#cb28-303" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb28-304"><a href="#cb28-304" aria-hidden="true" tabindex="-1"></a>\left(\theta_1 \;\middle|\; \sum_i Y_{i, 1} = 217\right) &amp;\sim \text{Gamma}(219, 112) <span class="sc">\\</span></span>
<span id="cb28-305"><a href="#cb28-305" aria-hidden="true" tabindex="-1"></a>\left(\theta_2 \;\middle|\; \sum_i Y_{i, 2} = 217\right) &amp;\sim \text{Gamma}(68, 45)</span>
<span id="cb28-306"><a href="#cb28-306" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb28-307"><a href="#cb28-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-308"><a href="#cb28-308" aria-hidden="true" tabindex="-1"></a>the corresponding derivation is thus</span>
<span id="cb28-309"><a href="#cb28-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-312"><a href="#cb28-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-313"><a href="#cb28-313" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb28-314"><a href="#cb28-314" aria-hidden="true" tabindex="-1"></a>theta1.mc <span class="ot">=</span> <span class="fu">rgamma</span>(N, <span class="dv">219</span>, <span class="dv">112</span>)</span>
<span id="cb28-315"><a href="#cb28-315" aria-hidden="true" tabindex="-1"></a>theta2.mc <span class="ot">=</span> <span class="fu">rgamma</span>(N, <span class="dv">68</span>, <span class="dv">45</span>)</span>
<span id="cb28-316"><a href="#cb28-316" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(theta1.mc <span class="sc">&gt;</span> theta2.mc)</span>
<span id="cb28-317"><a href="#cb28-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-318"><a href="#cb28-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-319"><a href="#cb28-319" aria-hidden="true" tabindex="-1"></a>Also, like the gamma example above, we can calculate some arbitrary function.</span>
<span id="cb28-320"><a href="#cb28-320" aria-hidden="true" tabindex="-1"></a>Say we are interested in the ratio $f(\theta_1, \theta_2) = \theta_1/\theta_2$ </span>
<span id="cb28-321"><a href="#cb28-321" aria-hidden="true" tabindex="-1"></a>of the means. On average, how many times more children do women without </span>
<span id="cb28-322"><a href="#cb28-322" aria-hidden="true" tabindex="-1"></a>bachelor's degrees have compared to those with bachelor's degrees. Then we</span>
<span id="cb28-323"><a href="#cb28-323" aria-hidden="true" tabindex="-1"></a>sample multiple pairs $(\theta^{(i)}_1, \theta^{(i)}_2)$, and multiple pairs $\gamma^i =</span>
<span id="cb28-324"><a href="#cb28-324" aria-hidden="true" tabindex="-1"></a>f(\theta^{(i)}_1, \theta^{(i)}_2)$.</span>
<span id="cb28-325"><a href="#cb28-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-326"><a href="#cb28-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb28-327"><a href="#cb28-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Common prior</span></span>
<span id="cb28-328"><a href="#cb28-328" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb28-329"><a href="#cb28-329" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb28-330"><a href="#cb28-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Without bachelor's</span></span>
<span id="cb28-331"><a href="#cb28-331" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">=</span> <span class="dv">111</span></span>
<span id="cb28-332"><a href="#cb28-332" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">=</span> <span class="dv">217</span></span>
<span id="cb28-333"><a href="#cb28-333" aria-hidden="true" tabindex="-1"></a><span class="co"># With</span></span>
<span id="cb28-334"><a href="#cb28-334" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">=</span> <span class="dv">44</span></span>
<span id="cb28-335"><a href="#cb28-335" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">=</span> <span class="dv">66</span></span>
<span id="cb28-336"><a href="#cb28-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-337"><a href="#cb28-337" aria-hidden="true" tabindex="-1"></a>n.samp <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb28-338"><a href="#cb28-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-339"><a href="#cb28-339" aria-hidden="true" tabindex="-1"></a>ratio <span class="ot">=</span> <span class="cf">function</span>(a, b) a <span class="sc">/</span> b <span class="co"># Not necessary, but good for foramlization</span></span>
<span id="cb28-340"><a href="#cb28-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-341"><a href="#cb28-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate prior distribution for good measure</span></span>
<span id="cb28-342"><a href="#cb28-342" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">=</span> <span class="fu">ratio</span>(<span class="fu">rgamma</span>(n.samp, a, b), <span class="fu">rgamma</span>(n.samp, a, b))</span>
<span id="cb28-343"><a href="#cb28-343" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">=</span> <span class="fu">ratio</span>(<span class="fu">rgamma</span>(n.samp, a <span class="sc">+</span> y1, b <span class="sc">+</span> n1), <span class="fu">rgamma</span>(n.samp, a <span class="sc">+</span> y2, b <span class="sc">+</span> n2))</span>
<span id="cb28-344"><a href="#cb28-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-345"><a href="#cb28-345" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">=</span> <span class="fu">melt</span>(<span class="fu">cbind</span>(prior, posterior))</span>
<span id="cb28-346"><a href="#cb28-346" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(combined) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'n'</span>, <span class="st">'type'</span>, <span class="st">'value'</span>)</span>
<span id="cb28-347"><a href="#cb28-347" aria-hidden="true" tabindex="-1"></a>combined<span class="sc">$</span>type <span class="ot">=</span> <span class="fu">factor</span>(combined<span class="sc">$</span>type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'prior'</span>, <span class="st">'posterior'</span>))</span>
<span id="cb28-348"><a href="#cb28-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-349"><a href="#cb28-349" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">group =</span> type, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb28-350"><a href="#cb28-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type, <span class="at">scales =</span> <span class="st">'free_y'</span>) <span class="sc">+</span></span>
<span id="cb28-351"><a href="#cb28-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb28-352"><a href="#cb28-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-353"><a href="#cb28-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>] <span class="sc">/</span> theta[<span class="dv">2</span>]))</span>
<span id="cb28-354"><a href="#cb28-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-355"><a href="#cb28-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-356"><a href="#cb28-356" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sampling from predictive distributions</span></span>
<span id="cb28-357"><a href="#cb28-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-358"><a href="#cb28-358" aria-hidden="true" tabindex="-1"></a>Recall that predictive distributions are distributions of new realizations of a</span>
<span id="cb28-359"><a href="#cb28-359" aria-hidden="true" tabindex="-1"></a>random variable when existing data have been conditioned on and unknown</span>
<span id="cb28-360"><a href="#cb28-360" aria-hidden="true" tabindex="-1"></a>quantities (i.e. parameters) are integrated out.</span>
<span id="cb28-361"><a href="#cb28-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-362"><a href="#cb28-362" aria-hidden="true" tabindex="-1"></a>For example, given a prior distribution $p(\theta)$, how can we calculate the</span>
<span id="cb28-363"><a href="#cb28-363" aria-hidden="true" tabindex="-1"></a>*prior predictive distribution* $p(\tilde{y})$? Often we have an analytical</span>
<span id="cb28-364"><a href="#cb28-364" aria-hidden="true" tabindex="-1"></a>solution for the form a posterior predictive distribution for a given model. But</span>
<span id="cb28-365"><a href="#cb28-365" aria-hidden="true" tabindex="-1"></a>often we can simply sample many $\theta^{(i)}$ from our posterior distribution on</span>
<span id="cb28-366"><a href="#cb28-366" aria-hidden="true" tabindex="-1"></a>$\theta$, and then sample a $y^{(i)}$ for each $\theta^{(i)}$. Specifically, $<span class="sc">\{</span>(\theta,</span>
<span id="cb28-367"><a href="#cb28-367" aria-hidden="true" tabindex="-1"></a>\tilde{y}) <span class="sc">\}</span>^{(1)}, \dots, (\theta, \tilde{y})^{(S)} <span class="sc">\}</span>$ are samples from the joint</span>
<span id="cb28-368"><a href="#cb28-368" aria-hidden="true" tabindex="-1"></a>posterior distribution of $\theta, \tilde{Y}$, and the sequence $<span class="sc">\{</span>\tilde{y}^{(1)},</span>
<span id="cb28-369"><a href="#cb28-369" aria-hidden="true" tabindex="-1"></a>\dots, \tilde{y}^{(S)}<span class="sc">\}</span>$ are samples from the *marginal* posterior distribution of</span>
<span id="cb28-370"><a href="#cb28-370" aria-hidden="true" tabindex="-1"></a>$\tilde{Y}$ (if we had an infinite number of samples, we would be "summing" over all theta).</span>
<span id="cb28-371"><a href="#cb28-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-372"><a href="#cb28-372" aria-hidden="true" tabindex="-1"></a><span class="fu"># Posterior predictive model checking</span></span>
<span id="cb28-373"><a href="#cb28-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-374"><a href="#cb28-374" aria-hidden="true" tabindex="-1"></a>Because exercises 4.3 and 4.8 address this, I'm skipping this section for now.</span>
<span id="cb28-375"><a href="#cb28-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-376"><a href="#cb28-376" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercises</span></span>
<span id="cb28-377"><a href="#cb28-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-378"><a href="#cb28-378" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.1</span></span>
<span id="cb28-379"><a href="#cb28-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-380"><a href="#cb28-380" aria-hidden="true" tabindex="-1"></a>For the county in exercise 3.1, $\theta_3 \mid \sum Y_i = y \sim \text{Beta}(58,</span>
<span id="cb28-381"><a href="#cb28-381" aria-hidden="true" tabindex="-1"></a>44)$.</span>
<span id="cb28-382"><a href="#cb28-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-383"><a href="#cb28-383" aria-hidden="true" tabindex="-1"></a>For this county, assuming a uniform prior, $\theta_4 \mid \sum Y_i = y \sim</span>
<span id="cb28-384"><a href="#cb28-384" aria-hidden="true" tabindex="-1"></a>\text{Beta}(31, 21)$.</span>
<span id="cb28-385"><a href="#cb28-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-386"><a href="#cb28-386" aria-hidden="true" tabindex="-1"></a>So,</span>
<span id="cb28-387"><a href="#cb28-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-390"><a href="#cb28-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-391"><a href="#cb28-391" aria-hidden="true" tabindex="-1"></a>theta1.mc <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">5000</span>, <span class="dv">58</span>, <span class="dv">44</span>)</span>
<span id="cb28-392"><a href="#cb28-392" aria-hidden="true" tabindex="-1"></a>theta2.mc <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">5000</span>, <span class="dv">31</span>, <span class="dv">21</span>)</span>
<span id="cb28-393"><a href="#cb28-393" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(theta1.mc <span class="sc">&lt;</span> theta2.mc)</span>
<span id="cb28-394"><a href="#cb28-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-395"><a href="#cb28-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-396"><a href="#cb28-396" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.2</span></span>
<span id="cb28-397"><a href="#cb28-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-398"><a href="#cb28-398" aria-hidden="true" tabindex="-1"></a><span class="fu">### a</span></span>
<span id="cb28-399"><a href="#cb28-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-402"><a href="#cb28-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-403"><a href="#cb28-403" aria-hidden="true" tabindex="-1"></a>theta.a <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">5000</span>, <span class="dv">237</span>, <span class="dv">20</span>)</span>
<span id="cb28-404"><a href="#cb28-404" aria-hidden="true" tabindex="-1"></a>theta.b <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">5000</span>, <span class="dv">125</span>, <span class="dv">14</span>)</span>
<span id="cb28-405"><a href="#cb28-405" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(theta.b <span class="sc">&lt;</span> theta.a)</span>
<span id="cb28-406"><a href="#cb28-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-407"><a href="#cb28-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-408"><a href="#cb28-408" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb28-409"><a href="#cb28-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-412"><a href="#cb28-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-413"><a href="#cb28-413" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb28-414"><a href="#cb28-414" aria-hidden="true" tabindex="-1"></a>exps <span class="ot">=</span> <span class="fu">sapply</span>(n0, <span class="cf">function</span>(n) { </span>
<span id="cb28-415"><a href="#cb28-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">rgamma</span>(<span class="dv">5000</span>, (<span class="dv">12</span> <span class="sc">*</span> n) <span class="sc">+</span> <span class="dv">113</span>, n <span class="sc">+</span> <span class="dv">13</span>) <span class="sc">&lt;</span> <span class="fu">rgamma</span>(<span class="dv">5000</span>, <span class="dv">237</span>, <span class="dv">20</span>))</span>
<span id="cb28-416"><a href="#cb28-416" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-417"><a href="#cb28-417" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, exps, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">'point'</span>, <span class="st">'smooth'</span>))</span>
<span id="cb28-418"><a href="#cb28-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-419"><a href="#cb28-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-420"><a href="#cb28-420" aria-hidden="true" tabindex="-1"></a>Even a strong factor of $n_0$ has a</span>
<span id="cb28-421"><a href="#cb28-421" aria-hidden="true" tabindex="-1"></a>relatively minimal effect on the posterior distribution.</span>
<span id="cb28-422"><a href="#cb28-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-423"><a href="#cb28-423" aria-hidden="true" tabindex="-1"></a><span class="fu">### c</span></span>
<span id="cb28-424"><a href="#cb28-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-425"><a href="#cb28-425" aria-hidden="true" tabindex="-1"></a>Recall for a Poisson model, the posterior predictive distribution after a</span>
<span id="cb28-426"><a href="#cb28-426" aria-hidden="true" tabindex="-1"></a>$\text{Gamma}(a, b)$ prior is a negative binomial distribution $\text{NB}(a +</span>
<span id="cb28-427"><a href="#cb28-427" aria-hidden="true" tabindex="-1"></a>\sum y_i, b, n)$. (The posterior predictive parameters are the same as those of the</span>
<span id="cb28-428"><a href="#cb28-428" aria-hidden="true" tabindex="-1"></a>posterior distribution itself). However, we can also simulate it by sampling</span>
<span id="cb28-429"><a href="#cb28-429" aria-hidden="true" tabindex="-1"></a>from the Poisson distribution implied by the sampled theta.</span>
<span id="cb28-430"><a href="#cb28-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-433"><a href="#cb28-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a>ys <span class="ot">=</span> <span class="fu">sapply</span>(n0, <span class="cf">function</span>(n) {</span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a>  theta.a <span class="ot">=</span> <span class="fu">rgamma</span>(N, <span class="dv">237</span>, <span class="dv">20</span>)</span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a>  theta.b <span class="ot">=</span> <span class="fu">rgamma</span>(N, (<span class="dv">12</span> <span class="sc">*</span> n) <span class="sc">+</span> <span class="dv">113</span>, n <span class="sc">+</span> <span class="dv">13</span>)</span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a>  y.a <span class="ot">=</span> <span class="fu">rpois</span>(N, theta.a)</span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a>  y.b <span class="ot">=</span> <span class="fu">rpois</span>(N, theta.b)</span>
<span id="cb28-441"><a href="#cb28-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(y.b <span class="sc">&lt;</span> y.a)</span>
<span id="cb28-442"><a href="#cb28-442" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-443"><a href="#cb28-443" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, ys, <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">'point'</span>, <span class="st">'smooth'</span>))</span>
<span id="cb28-444"><a href="#cb28-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-445"><a href="#cb28-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-446"><a href="#cb28-446" aria-hidden="true" tabindex="-1"></a>Which appears to be a different relationship - exactly what it is could be</span>
<span id="cb28-447"><a href="#cb28-447" aria-hidden="true" tabindex="-1"></a>calculated by integrating the quantity using the posterior distribution, then figuring out what the shape is as a function of $n_0$.</span>
<span id="cb28-448"><a href="#cb28-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-449"><a href="#cb28-449" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.3</span></span>
<span id="cb28-450"><a href="#cb28-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-453"><a href="#cb28-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-454"><a href="#cb28-454" aria-hidden="true" tabindex="-1"></a>ya <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">6</span>)</span>
<span id="cb28-455"><a href="#cb28-455" aria-hidden="true" tabindex="-1"></a>yb <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">7</span>)</span>
<span id="cb28-456"><a href="#cb28-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-457"><a href="#cb28-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-458"><a href="#cb28-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### a</span></span>
<span id="cb28-459"><a href="#cb28-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-460"><a href="#cb28-460" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`ya`</span>:</span>
<span id="cb28-461"><a href="#cb28-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-464"><a href="#cb28-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-465"><a href="#cb28-465" aria-hidden="true" tabindex="-1"></a>theta1 <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="dv">2</span> <span class="sc">+</span> <span class="fu">sum</span>(ya), <span class="dv">1</span> <span class="sc">+</span> <span class="fu">length</span>(ya))</span>
<span id="cb28-466"><a href="#cb28-466" aria-hidden="true" tabindex="-1"></a>ts <span class="ot">=</span> <span class="fu">sapply</span>(theta1, <span class="cf">function</span>(theta) {</span>
<span id="cb28-467"><a href="#cb28-467" aria-hidden="true" tabindex="-1"></a>  ys <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">10</span>, theta)</span>
<span id="cb28-468"><a href="#cb28-468" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">=</span> <span class="fu">mean</span>(ys) <span class="sc">/</span> <span class="fu">sd</span>(ys)</span>
<span id="cb28-469"><a href="#cb28-469" aria-hidden="true" tabindex="-1"></a>  t</span>
<span id="cb28-470"><a href="#cb28-470" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-471"><a href="#cb28-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-472"><a href="#cb28-472" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">ts =</span> ts), <span class="fu">aes</span>(<span class="at">x =</span> ts)) <span class="sc">+</span></span>
<span id="cb28-473"><a href="#cb28-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb28-474"><a href="#cb28-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(ya) <span class="sc">/</span> <span class="fu">sd</span>(ya))</span>
<span id="cb28-475"><a href="#cb28-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-476"><a href="#cb28-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-477"><a href="#cb28-477" aria-hidden="true" tabindex="-1"></a>Since the observed statistic (vertical line) is centered well within the</span>
<span id="cb28-478"><a href="#cb28-478" aria-hidden="true" tabindex="-1"></a>standard spread of the observed $t(s)$, we have no reason to believe the fit of</span>
<span id="cb28-479"><a href="#cb28-479" aria-hidden="true" tabindex="-1"></a>the Poisson model is bad. Also, since $t(s)$ depends on the only parameter of</span>
<span id="cb28-480"><a href="#cb28-480" aria-hidden="true" tabindex="-1"></a>the data $\theta$, it can thus be inferred that the Poisson model seems to fit reasonably in this case.</span>
<span id="cb28-481"><a href="#cb28-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-482"><a href="#cb28-482" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb28-483"><a href="#cb28-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-484"><a href="#cb28-484" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`yb`</span>:</span>
<span id="cb28-485"><a href="#cb28-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-488"><a href="#cb28-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-489"><a href="#cb28-489" aria-hidden="true" tabindex="-1"></a>theta2 <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1000</span>, <span class="dv">2</span> <span class="sc">+</span> <span class="fu">sum</span>(yb), <span class="dv">1</span> <span class="sc">+</span> <span class="fu">length</span>(yb))</span>
<span id="cb28-490"><a href="#cb28-490" aria-hidden="true" tabindex="-1"></a>ts <span class="ot">=</span> <span class="fu">sapply</span>(theta2, <span class="cf">function</span>(theta) {</span>
<span id="cb28-491"><a href="#cb28-491" aria-hidden="true" tabindex="-1"></a>  ys <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">10</span>, theta)</span>
<span id="cb28-492"><a href="#cb28-492" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">=</span> <span class="fu">mean</span>(ys) <span class="sc">/</span> <span class="fu">sd</span>(ys)</span>
<span id="cb28-493"><a href="#cb28-493" aria-hidden="true" tabindex="-1"></a>  t</span>
<span id="cb28-494"><a href="#cb28-494" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-495"><a href="#cb28-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-496"><a href="#cb28-496" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">ts =</span> ts), <span class="fu">aes</span>(<span class="at">x =</span> ts)) <span class="sc">+</span></span>
<span id="cb28-497"><a href="#cb28-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb28-498"><a href="#cb28-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(yb) <span class="sc">/</span> <span class="fu">sd</span>(yb))</span>
<span id="cb28-499"><a href="#cb28-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-500"><a href="#cb28-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-501"><a href="#cb28-501" aria-hidden="true" tabindex="-1"></a>Since the observed statistic (vertical line) seems to be an outlier for the range of statistics normally seen in this dataset, we can infer that the Poisson model does not seem to fit this dataset well.</span>
<span id="cb28-502"><a href="#cb28-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-503"><a href="#cb28-503" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.6</span></span>
<span id="cb28-504"><a href="#cb28-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-505"><a href="#cb28-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### via Monte-Carlo sampling</span></span>
<span id="cb28-506"><a href="#cb28-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-509"><a href="#cb28-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-510"><a href="#cb28-510" aria-hidden="true" tabindex="-1"></a>theta.mc <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">10000</span>)</span>
<span id="cb28-511"><a href="#cb28-511" aria-hidden="true" tabindex="-1"></a>gamma.mc <span class="ot">=</span> <span class="fu">sapply</span>(theta.mc, <span class="cf">function</span>(theta) <span class="fu">log</span>(theta <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> theta)))</span>
<span id="cb28-512"><a href="#cb28-512" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">gamma =</span> gamma.mc), <span class="fu">aes</span>(<span class="at">x =</span> gamma, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb28-513"><a href="#cb28-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb28-514"><a href="#cb28-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-515"><a href="#cb28-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-516"><a href="#cb28-516" aria-hidden="true" tabindex="-1"></a>Yes, the prior for $\gamma$ is centered around 0 and appears to be normally </span>
<span id="cb28-517"><a href="#cb28-517" aria-hidden="true" tabindex="-1"></a>distributed. Naturally, $p(\gamma)$  must be centered around something, since</span>
<span id="cb28-518"><a href="#cb28-518" aria-hidden="true" tabindex="-1"></a>you cannot have a uniform distribution on an infinite interval.</span>
<span id="cb28-519"><a href="#cb28-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-520"><a href="#cb28-520" aria-hidden="true" tabindex="-1"></a><span class="fu">### analytically</span></span>
<span id="cb28-521"><a href="#cb28-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-522"><a href="#cb28-522" aria-hidden="true" tabindex="-1"></a>This is computed in Exercise 3.10 (a).</span>
<span id="cb28-523"><a href="#cb28-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-524"><a href="#cb28-524" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.7</span></span>
<span id="cb28-525"><a href="#cb28-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-526"><a href="#cb28-526" aria-hidden="true" tabindex="-1"></a><span class="fu">### a</span></span>
<span id="cb28-527"><a href="#cb28-527" aria-hidden="true" tabindex="-1"></a>We first sample $(\theta, \sigma^2)$ via sampling from $p(\sigma^2)$ and then</span>
<span id="cb28-528"><a href="#cb28-528" aria-hidden="true" tabindex="-1"></a>$p(\theta \mid \sigma^2)$:</span>
<span id="cb28-529"><a href="#cb28-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-532"><a href="#cb28-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-533"><a href="#cb28-533" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb28-534"><a href="#cb28-534" aria-hidden="true" tabindex="-1"></a>sigma2.mc <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">rgamma</span>(N, <span class="dv">10</span>, <span class="fl">2.5</span>)</span>
<span id="cb28-535"><a href="#cb28-535" aria-hidden="true" tabindex="-1"></a>theta.mc <span class="ot">=</span> <span class="fu">rnorm</span>(N, <span class="fl">4.1</span>, sigma2.mc <span class="sc">/</span> <span class="dv">20</span>)</span>
<span id="cb28-536"><a href="#cb28-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-537"><a href="#cb28-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-538"><a href="#cb28-538" aria-hidden="true" tabindex="-1"></a>Now we can sample according to the mixture posterior distribution:</span>
<span id="cb28-541"><a href="#cb28-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-542"><a href="#cb28-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't forget about sqrt!</span></span>
<span id="cb28-543"><a href="#cb28-543" aria-hidden="true" tabindex="-1"></a>sigma.mc <span class="ot">=</span> <span class="fu">sqrt</span>(sigma2.mc)</span>
<span id="cb28-544"><a href="#cb28-544" aria-hidden="true" tabindex="-1"></a>ynew.mc <span class="ot">=</span> .<span class="dv">31</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N, theta.mc, sigma.mc) <span class="sc">+</span></span>
<span id="cb28-545"><a href="#cb28-545" aria-hidden="true" tabindex="-1"></a>  .<span class="dv">46</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N, <span class="dv">2</span> <span class="sc">*</span> theta.mc, <span class="dv">2</span> <span class="sc">*</span> sigma.mc) <span class="sc">+</span></span>
<span id="cb28-546"><a href="#cb28-546" aria-hidden="true" tabindex="-1"></a>  .<span class="dv">23</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N, <span class="dv">3</span> <span class="sc">*</span> theta.mc, <span class="dv">3</span> <span class="sc">*</span> sigma.mc)</span>
<span id="cb28-547"><a href="#cb28-547" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ynew.mc)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb28-548"><a href="#cb28-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-549"><a href="#cb28-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-550"><a href="#cb28-550" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb28-553"><a href="#cb28-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-554"><a href="#cb28-554" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(ynew.mc, <span class="fu">c</span>(.<span class="dv">125</span>, .<span class="dv">875</span>))</span>
<span id="cb28-555"><a href="#cb28-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-556"><a href="#cb28-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-557"><a href="#cb28-557" aria-hidden="true" tabindex="-1"></a><span class="fu">### c</span></span>
<span id="cb28-558"><a href="#cb28-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-561"><a href="#cb28-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-562"><a href="#cb28-562" aria-hidden="true" tabindex="-1"></a><span class="co"># i. Compute and normalize density</span></span>
<span id="cb28-563"><a href="#cb28-563" aria-hidden="true" tabindex="-1"></a>dens <span class="ot">=</span> <span class="fu">density</span>(ynew.mc)</span>
<span id="cb28-564"><a href="#cb28-564" aria-hidden="true" tabindex="-1"></a>dens.ynorm <span class="ot">=</span> dens<span class="sc">$</span>y <span class="sc">/</span> <span class="fu">sum</span>(dens<span class="sc">$</span>y)</span>
<span id="cb28-565"><a href="#cb28-565" aria-hidden="true" tabindex="-1"></a><span class="co"># ii. Sort in decreasing order</span></span>
<span id="cb28-566"><a href="#cb28-566" aria-hidden="true" tabindex="-1"></a>dens.ynorm.desc <span class="ot">=</span> dens.ynorm[<span class="fu">order</span>(dens.ynorm, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb28-567"><a href="#cb28-567" aria-hidden="true" tabindex="-1"></a><span class="co"># iii. Find first probability value st cumsum of sorted values &gt; 0.75</span></span>
<span id="cb28-568"><a href="#cb28-568" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">=</span> dens.ynorm.desc[<span class="fu">min</span>(<span class="fu">which</span>(<span class="fu">cumsum</span>(dens.ynorm.desc) <span class="sc">&gt;</span> <span class="fl">0.75</span>))]</span>
<span id="cb28-569"><a href="#cb28-569" aria-hidden="true" tabindex="-1"></a>in.hdp <span class="ot">=</span> dens.ynorm <span class="sc">&gt;</span> cutoff</span>
<span id="cb28-570"><a href="#cb28-570" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">y =</span> dens<span class="sc">$</span>x, <span class="at">density =</span> dens.ynorm, <span class="at">hdp =</span> in.hdp)) <span class="sc">+</span></span>
<span id="cb28-571"><a href="#cb28-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> density, <span class="at">color =</span> hdp))</span>
<span id="cb28-572"><a href="#cb28-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-573"><a href="#cb28-573" aria-hidden="true" tabindex="-1"></a>dens<span class="sc">$</span>x[<span class="fu">c</span>(<span class="fu">min</span>(<span class="fu">which</span>(in.hdp)), <span class="fu">max</span>(<span class="fu">which</span>(in.hdp)))]</span>
<span id="cb28-574"><a href="#cb28-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-575"><a href="#cb28-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-576"><a href="#cb28-576" aria-hidden="true" tabindex="-1"></a>Since the distribution of weights is relatively symmetric and normally</span>
<span id="cb28-577"><a href="#cb28-577" aria-hidden="true" tabindex="-1"></a>distributed, the HDP and quantile confidence intervals are quite similar.</span>
<span id="cb28-578"><a href="#cb28-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-579"><a href="#cb28-579" aria-hidden="true" tabindex="-1"></a><span class="fu">### d</span></span>
<span id="cb28-580"><a href="#cb28-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-581"><a href="#cb28-581" aria-hidden="true" tabindex="-1"></a>Perhaps a combination of multiple parts of a vegetable which have known</span>
<span id="cb28-582"><a href="#cb28-582" aria-hidden="true" tabindex="-1"></a>distributions (e.g. stem, fruit, leaves, etc)</span>
<span id="cb28-583"><a href="#cb28-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-584"><a href="#cb28-584" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.8</span></span>
<span id="cb28-585"><a href="#cb28-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-588"><a href="#cb28-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-589"><a href="#cb28-589" aria-hidden="true" tabindex="-1"></a>menchild30bach <span class="ot">=</span> <span class="fu">scan</span>(<span class="st">'Exercises/menchild30bach.dat'</span>)</span>
<span id="cb28-590"><a href="#cb28-590" aria-hidden="true" tabindex="-1"></a>menchild30nobach <span class="ot">=</span> <span class="fu">scan</span>(<span class="st">'Exercises/menchild30nobach.dat'</span>)</span>
<span id="cb28-591"><a href="#cb28-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-592"><a href="#cb28-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-593"><a href="#cb28-593" aria-hidden="true" tabindex="-1"></a><span class="fu">### a</span></span>
<span id="cb28-594"><a href="#cb28-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-597"><a href="#cb28-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-598"><a href="#cb28-598" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb28-599"><a href="#cb28-599" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb28-600"><a href="#cb28-600" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb28-601"><a href="#cb28-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-602"><a href="#cb28-602" aria-hidden="true" tabindex="-1"></a>thetaA <span class="ot">=</span> <span class="fu">rgamma</span>(N, a <span class="sc">+</span> <span class="fu">sum</span>(menchild30bach), b <span class="sc">+</span> <span class="fu">length</span>(menchild30bach))</span>
<span id="cb28-603"><a href="#cb28-603" aria-hidden="true" tabindex="-1"></a>thetaB <span class="ot">=</span> <span class="fu">rgamma</span>(N, a <span class="sc">+</span> <span class="fu">sum</span>(menchild30nobach), b <span class="sc">+</span> <span class="fu">length</span>(menchild30nobach))</span>
<span id="cb28-604"><a href="#cb28-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-605"><a href="#cb28-605" aria-hidden="true" tabindex="-1"></a>ynewA <span class="ot">=</span> <span class="fu">rpois</span>(N, thetaA)</span>
<span id="cb28-606"><a href="#cb28-606" aria-hidden="true" tabindex="-1"></a>ynewB <span class="ot">=</span> <span class="fu">rpois</span>(N, thetaB)</span>
<span id="cb28-607"><a href="#cb28-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-608"><a href="#cb28-608" aria-hidden="true" tabindex="-1"></a>pos.predict <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-609"><a href="#cb28-609" aria-hidden="true" tabindex="-1"></a>  <span class="at">ynew =</span> <span class="fu">c</span>(ynewA, ynewB),</span>
<span id="cb28-610"><a href="#cb28-610" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'bach'</span>, <span class="st">'nobach'</span>), <span class="at">each =</span> N), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'bach'</span>, <span class="st">'nobach'</span>)),</span>
<span id="cb28-611"><a href="#cb28-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">'posterior'</span></span>
<span id="cb28-612"><a href="#cb28-612" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-613"><a href="#cb28-613" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pos.predict, <span class="fu">aes</span>(<span class="at">x =</span> ynew, <span class="at">group =</span> dist)) <span class="sc">+</span></span>
<span id="cb28-614"><a href="#cb28-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb28-615"><a href="#cb28-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> dist)</span>
<span id="cb28-616"><a href="#cb28-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-617"><a href="#cb28-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-618"><a href="#cb28-618" aria-hidden="true" tabindex="-1"></a><span class="fu">### b</span></span>
<span id="cb28-619"><a href="#cb28-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-622"><a href="#cb28-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a>theta.diff <span class="ot">=</span> thetaB <span class="sc">-</span> thetaA</span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Theta difference:"</span>)</span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">quantile</span>(theta.diff, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a>ynew.diff <span class="ot">=</span> ynewB <span class="sc">-</span> ynewA</span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Ynew difference:"</span>)</span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">quantile</span>(ynew.diff, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a>Since the confidence interval for $\theta_B - \theta_A$ does not contain zero, </span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a>we believe with at least approximately 95% probability that the true posterior </span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a>mean $\theta_B$ is greater than $\theta_A$. However, the same does not hold true</span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a>for the means of the difference between two individuals sampled from this</span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a>distribution, due to the increased uncertainty in the posterior predictive</span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a>distribution.</span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a><span class="fu">### c</span></span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-643"><a href="#cb28-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-644"><a href="#cb28-644" aria-hidden="true" tabindex="-1"></a>emp.df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-645"><a href="#cb28-645" aria-hidden="true" tabindex="-1"></a>  <span class="at">ynew =</span> <span class="fu">c</span>(menchild30bach, menchild30nobach),</span>
<span id="cb28-646"><a href="#cb28-646" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'bach'</span>, <span class="fu">length</span>(menchild30bach)), <span class="fu">rep</span>(<span class="st">'nobach'</span>, <span class="fu">length</span>(menchild30nobach))), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'bach'</span>, <span class="st">'nobach'</span>)),</span>
<span id="cb28-647"><a href="#cb28-647" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">'empirical'</span></span>
<span id="cb28-648"><a href="#cb28-648" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-649"><a href="#cb28-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-650"><a href="#cb28-650" aria-hidden="true" tabindex="-1"></a>total.df <span class="ot">=</span> <span class="fu">rbind</span>(pos.predict, emp.df)</span>
<span id="cb28-651"><a href="#cb28-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-652"><a href="#cb28-652" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(total.df, <span class="fu">aes</span>(<span class="at">x =</span> ynew, <span class="at">y =</span> ..density.., <span class="at">group =</span> type, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb28-653"><a href="#cb28-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">'dodge'</span>) <span class="sc">+</span></span>
<span id="cb28-654"><a href="#cb28-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> dist)</span>
<span id="cb28-655"><a href="#cb28-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-656"><a href="#cb28-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-657"><a href="#cb28-657" aria-hidden="true" tabindex="-1"></a>The posterior distribution for $\tilde{Y}_B$ seems to peak around 1, while the</span>
<span id="cb28-658"><a href="#cb28-658" aria-hidden="true" tabindex="-1"></a>empirical distribution peaks strongly around 0. Thus I think this is an error in the model fit.</span>
<span id="cb28-659"><a href="#cb28-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-660"><a href="#cb28-660" aria-hidden="true" tabindex="-1"></a>(Observe that the mean of the nobach population is around 1.4)</span>
<span id="cb28-661"><a href="#cb28-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-664"><a href="#cb28-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-665"><a href="#cb28-665" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ynewB)</span>
<span id="cb28-666"><a href="#cb28-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-667"><a href="#cb28-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-668"><a href="#cb28-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### d</span></span>
<span id="cb28-669"><a href="#cb28-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-670"><a href="#cb28-670" aria-hidden="true" tabindex="-1"></a>Model checking, by computing a statistic that may be of interest:</span>
<span id="cb28-671"><a href="#cb28-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-674"><a href="#cb28-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-675"><a href="#cb28-675" aria-hidden="true" tabindex="-1"></a>zeroandone <span class="ot">=</span> <span class="fu">lapply</span>(thetaB, <span class="cf">function</span>(theta) {</span>
<span id="cb28-676"><a href="#cb28-676" aria-hidden="true" tabindex="-1"></a>  nB <span class="ot">=</span> <span class="fu">rpois</span>(<span class="dv">218</span>, theta)</span>
<span id="cb28-677"><a href="#cb28-677" aria-hidden="true" tabindex="-1"></a>  n0s <span class="ot">=</span> <span class="fu">sum</span>(nB <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb28-678"><a href="#cb28-678" aria-hidden="true" tabindex="-1"></a>  n1s <span class="ot">=</span> <span class="fu">sum</span>(nB <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb28-679"><a href="#cb28-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(n0s, n1s)</span>
<span id="cb28-680"><a href="#cb28-680" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-681"><a href="#cb28-681" aria-hidden="true" tabindex="-1"></a>zeros <span class="ot">=</span> <span class="fu">sapply</span>(zeroandone, <span class="cf">function</span>(t) t[<span class="dv">1</span>])</span>
<span id="cb28-682"><a href="#cb28-682" aria-hidden="true" tabindex="-1"></a>ones <span class="ot">=</span> <span class="fu">sapply</span>(zeroandone, <span class="cf">function</span>(t) t[<span class="dv">2</span>])</span>
<span id="cb28-683"><a href="#cb28-683" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">zeros =</span> zeros, <span class="at">ones =</span> ones)) <span class="sc">+</span></span>
<span id="cb28-684"><a href="#cb28-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> zeros, <span class="at">y =</span> ones), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb28-685"><a href="#cb28-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'point'</span>, <span class="at">x =</span> <span class="fu">sum</span>(menchild30nobach <span class="sc">==</span> <span class="dv">0</span>), <span class="at">y =</span> <span class="fu">sum</span>(menchild30nobach <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">'red'</span>)</span>
<span id="cb28-686"><a href="#cb28-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-687"><a href="#cb28-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-688"><a href="#cb28-688" aria-hidden="true" tabindex="-1"></a>The observed statistic is in red. Notice how it seems somewhat abnormal for</span>
<span id="cb28-689"><a href="#cb28-689" aria-hidden="true" tabindex="-1"></a>sample datasets from our poisson model with $\theta = 1.4$ especially in the</span>
<span id="cb28-690"><a href="#cb28-690" aria-hidden="true" tabindex="-1"></a>case of the number of ones observed. This is a clear indicator that the fit of our Poisson model is suboptimal.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© Jesse Mu</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/edit/main/4.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/d-morrison/hoff-bayesian-statistics/blob/main/4.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>